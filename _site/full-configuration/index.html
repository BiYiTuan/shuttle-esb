
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Full Configuration File</title>
    
    <meta name="author" content="Eben Roux">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/shuttle/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/shuttle/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/shuttle/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes/shuttle/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/shuttle/css/jquery.tocify.css" rel="stylesheet" type="text/css" media="all">
	
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">shuttle-esb</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
			<ul class='nav navbar-nav'>
				<li>
					<a href='/'>Home</a>
				</li>
				<li class='dropdown'>
					<a class='dropdown-toggle' data-toggle='dropdown' href='#'>
					Guides
					<b class='caret'></b>
					</a>
					<ul class='dropdown-menu'>
						<li>
							<a href='/getting-started'>Getting Started</a>
						</li>
						<li class='divider'></li>
						<li>
							<a href='/architecture'>Architecture &amp; Patterns</a>
						</li>
						<li class='divider'></li>
						<li>
							<a href='/modules'>Modules</a>
						</li>
					</ul>
				</li>
				<li class='dropdown'>
					<a class='dropdown-toggle' data-toggle='dropdown' href='#'>
					API
					<b class='caret'></b>
					</a>
					<ul class='dropdown-menu'>
						<li class='dropdown-header'>Core</li>
							<li>
								<a href='/encryption'>Encryption</a>
							</li>
							<li>
								<a href='/compression'>Compression</a>
							</li>
							<li>
								<a href='/idempotence-service'>Idempotence Service</a>
							</li>
							<li>
								<a href='/message-handler-factory'>Message Handler Factory</a>
							</li>
							<li>
								<a href='/message-route-provider'>Message Route Provider (+Forwarding)</a>
							</li>
							<li>
								<a href='/message-sender'>Message Sender</a>
							</li>
							<li>
								<a href='/pipeline-factory'>Pipeline Factory</a>
							</li>
							<li>
								<a href='/service-bus-policy'>Policy</a>
							</li>
							<li>
								<a href='/serializer'>Serializer</a>
							</li>
							<li>
								<a href='/service-bus'>Service Bus</a>
							</li>
							<li>
								<a href='/subscription-manager'>Subscription Manager</a>
							</li>
							<li>
								<a href='/thread-activity-factory'>Thread Activity Factory</a>
							</li>
							<li>
								<a href='/transactionscope-factory'>TransactionScope Factory</a>
							</li>
						<li class='divider'></li>
						<li class='dropdown-header'>Miscellaneous</li>
							<li>
								<a href='/full-configuration'>Full Configuration</a>
							</li>
						</li>
					</ul>
				</li>
				<li class='dropdown'>
					<a class='dropdown-toggle' data-toggle='dropdown' href='#'>
					Extensions
					<b class='caret'></b>
					</a>
					<ul class='dropdown-menu'>
						<li class='dropdown-header'>Queues</li>
							<li>
								<a href='/extensions-rabbitmq'>RabbitMQ</a>
							</li>
							<li>
								<a href='/extensions-msmq'>MSMQ</a>
							</li>
							<li>
								<a href='/extensions-sql-server'>Sql Server</a>
							</li>
						<li class='divider'></li>
						<li class='dropdown-header'>Factories</li>
							<li>
								<a href='/extensions-castle-project'>Castle Project</a>
							</li>
						</li>
						<li class='divider'></li>
						<li class='dropdown-header'>Modules</li>
							<li>
								<a href='/modules-corrupt-messages'>Corrupt Transport Messages</a>
							</li>
						</li>
					</ul>
				</li>
				<li>
					<a href='http://www.youtube.com/shuttleservicebus' target='_blank'>Videos</a>
				</li>
				<li>
					<a href='/archive'>Archive</a>
				</li>
				
				
				


  
    
      
    
  
    
      
      	
      	<li><a href="/archive/">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories/">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages/">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags/">Tags</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



			</ul>
          <ul class="nav navbar-nav navbar-right">
			
			<li>
			  <a href="https://github.com/Shuttle/shuttle-esb" class="hidden-xs hidden-sm" target="_blank">GitHub</a>
			</li>
			
		  </ul>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="row">
	<div id='toc-container' class='col-md-3'>
	<div id="toc-anchor"></div> 
	<div id='toc' class='visible-md visible-lg'></div>
	</div>
	<div class='col-md-9'>
	<h1>Full Application Configuration File</h1>

<p>This configuration is the default application configuration file based version.  Some components that you may replace could very well have their own configuration stores.</p>

<p>To start off add the <code>Shuttle.ESB.Core.ServiceBusSection</code> configuration class from the <code>Shuttle.ESB.Core</code> assembly.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;configSections&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">name=</span><span class="s">&#39;serviceBus&#39;</span> <span class="na">type=</span><span class="s">&quot;Shuttle.ESB.Core.ServiceBusSection, Shuttle.ESB.Core&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/configSections&gt;</span>
</code></pre></div>
<p>The most pertinent bit is the <code>serviceBus</code> tag.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">  <span class="nt">&lt;serviceBus</span>
    <span class="na">createQueues=</span><span class="s">&quot;true&quot;</span>  
    <span class="na">removeMessagesNotHandled=</span><span class="s">&quot;true&quot;</span>
    <span class="na">compressionAlgorithm=</span><span class="s">&quot;&quot;</span>
    <span class="na">encryptionAlgorithm=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<table><thead>
<tr>
<th>Attribute</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>createQueues</code></td>
<td>true</td>
<td>The endpoint will attempt to create all local queues (inbox, outbox, control inbox)</td>
</tr>
<tr>
<td><code>removeMessagesNotHandled</code></td>
<td>true</td>
<td>indicates whether messages received on the endpoint that have no message handler should simply be removed (ignored).  If this attribute is <code>false</code> then the message will immmediately be placed in the error queue.</td>
</tr>
<tr>
<td><code>compressionAlgorithm</code></td>
<td>empty (no compression)</td>
<td>The name of the compression algorithm to use when sending messages.  Out-of-the-box there is a GZip compression implementation (class <code>GZipCompressionAlgorithm</code> with name &#39;GZip&#39;).</td>
</tr>
<tr>
<td><code>encryptionAlgorithm</code></td>
<td>empty (no entryption)</td>
<td>The name of the encryption algorithm to use when sending messages.  Out-of-the-box there is a Triple DES implementation (class TripleDesEncryptionAlgorithm and name &#39;3DES&#39;).</td>
</tr>
</tbody></table>

<p>Use the <code>forwardingRoutes</code> tag to enable message forwarding.  All messages that are received and have been sucessfully handled will be forwarded to the specified queue.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">    <span class="nt">&lt;forwardingRoutes&gt;</span>
      <span class="nt">&lt;messageRoute</span> <span class="na">uri=</span><span class="s">&quot;msmq://./inbox&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">specification=</span><span class="s">&quot;StartsWith&quot;</span> <span class="na">value=</span><span class="s">&quot;Shuttle.Messages1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">specification=</span><span class="s">&quot;StartsWith&quot;</span> <span class="na">value=</span><span class="s">&quot;Shuttle.Messages2&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/messageRoute&gt;</span>
      <span class="nt">&lt;messageRoute</span> <span class="na">uri=</span><span class="s">&quot;sql://./inbox&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">specification=</span><span class="s">&quot;TypeList&quot;</span> <span class="na">value=</span><span class="s">&quot;DoSomethingCommand&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/messageRoute&gt;</span>
    <span class="nt">&lt;/forwardingRoutes&gt;</span>
</code></pre></div>
<p>The <code>messageRoutes</code> tag defines the routing for message that are sent using the <code>IServiceBus.Send</code> method.  You will notice that the structure is the same as the <code>forwardingRoutes</code> tag.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">    <span class="nt">&lt;messageRoutes&gt;</span>
      <span class="nt">&lt;messageRoute</span> <span class="na">uri=</span><span class="s">&quot;msmq://./inbox&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">specification=</span><span class="s">&quot;StartsWith&quot;</span> <span class="na">value=</span><span class="s">&quot;Shuttle.Messages1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">specification=</span><span class="s">&quot;StartsWith&quot;</span> <span class="na">value=</span><span class="s">&quot;Shuttle.Messages2&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/messageRoute&gt;</span>
      <span class="nt">&lt;messageRoute</span> <span class="na">uri=</span><span class="s">&quot;sql://./inbox&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">specification=</span><span class="s">&quot;TypeList&quot;</span> <span class="na">value=</span><span class="s">&quot;DoSomethingCommand&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/messageRoute&gt;</span>
    <span class="nt">&lt;/messageRoutes&gt;</span>
</code></pre></div>
<p>The <code>inbox</code> should be specified if the endpoint has message handlers that need to process incoming messages</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">    <span class="nt">&lt;inbox</span>
      <span class="na">workQueueUri=</span><span class="s">&quot;msmq://./inbox-work&quot;</span>
      <span class="na">deferredQueueUri=</span><span class="s">&quot;msmq://./inbox-work-deferred&quot;</span>
      <span class="na">errorQueueUri=</span><span class="s">&quot;msmq://./shuttle-error&quot;</span>
      <span class="na">workQueueStartupAction=</span><span class="s">&quot;Purge&quot;</span>
      <span class="na">threadCount=</span><span class="s">&quot;25&quot;</span>
      <span class="na">durationToSleepWhenIdle=</span><span class="s">&quot;250ms,10s,30s&quot;</span>
      <span class="na">durationToIgnoreOnFailure=</span><span class="s">&quot;30m,1h&quot;</span>
      <span class="na">maximumFailureCount=</span><span class="s">&quot;25&quot;</span> 
      <span class="na">distribute=</span><span class="s">&quot;true|false&quot;</span> 
      <span class="na">distributeSendCount=</span><span class="s">&quot;5&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<table><thead>
<tr>
<th>Attribute</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>workQueueStartupAction</code></td>
<td>&#39;None&#39;</td>
<td><ul><li>QueueStartupAction.None - inbox work queue is left as is.</li><li>QueueStartupAction.Purge - inbox work queue is purged at start-up</li><ul></td>
</tr>
<tr>
<td><code>threadCount</code></td>
<td>5</td>
<td>The number of worker threads that will service the inbox work queue.  The deferred queue will always be serviced by only 1 thread.</td>
</tr>
<tr>
<td><code>durationToSleepWhenIdle</code></td>
<td>250ms*4,500ms*2,1s</td>
<td></td>
</tr>
<tr>
<td><code>durationToIgnoreOnFailure</code></td>
<td>5m,10m,15m,30m,60m</td>
<td></td>
</tr>
<tr>
<td><code>maximumFailureCount</code></td>
<td>5</td>
<td>The maximum number of failures that are retried before the message is moved to the error queue.</td>
</tr>
<tr>
<td><code>distribute</code></td>
<td>false</td>
<td>If <code>true</code> the endpoint will act as only a distributor.  If <code>false</code> the endpoint will distribute messages if a worker is available; else process the message itself.</td>
</tr>
<tr>
<td><code>distributeSendCount</code></td>
<td>5</td>
<td>The number of messages to send to the work per available thread message received.  If less than 1 the default will be used.</td>
</tr>
</tbody></table>

<p>For some queueing technologies the <code>outbox</code> may not be required.  Msmq, for instance, create its own outgoing queues.  However, it should be used in scenarios where you need a store-and-forward mechanism for sending messages when the underlying infrastructure does not provide this such as with a SqlServer table-based queue or maybe even the file system.  RabbitMQ will also need an outbox since the destination broker may not be available and it does not have the concept of outgoing queues.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">    <span class="nt">&lt;outbox</span>
      <span class="na">workQueueUri=</span><span class="s">&quot;msmq://./outbox-work&quot;</span>
      <span class="na">errorQueueUri=</span><span class="s">&quot;msmq://./shuttle-error&quot;</span>
      <span class="na">durationToSleepWhenIdle=</span><span class="s">&quot;250ms,10s,30s&quot;</span>
      <span class="na">durationToIgnoreOnFailure=</span><span class="s">&quot;30m,1h&quot;</span>
      <span class="na">maximumFailureCount=</span><span class="s">&quot;25&quot;</span>
      <span class="na">threadCount=</span><span class="s">&quot;5&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<table><thead>
<tr>
<th>Attribute</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>threadCount</code></td>
<td>1</td>
<td>The number of worker threads that will service the outbox work queue.</td>
</tr>
<tr>
<td><code>durationToSleepWhenIdle</code></td>
<td>250ms*4,500ms*2,1s</td>
<td></td>
</tr>
<tr>
<td><code>durationToIgnoreOnFailure</code></td>
<td>5m,10m,15m,30m,60m</td>
<td></td>
</tr>
<tr>
<td><code>maximumFailureCount</code></td>
<td>5</td>
<td>The maximum number of failures that are retried before the message is moved to the error queue.</td>
</tr>
</tbody></table>

<p>You can also set the transaction scope behaviour by providing the <code>transactionScope</code> tag.  If you want your endpoint to be non-transactional then set the <code>enabled</code> attribute to <code>false</code>.  This will improve performance but messsage delivery and processing cannot be guaranteed.  If the underlying queueing infrastrcuture does not support 2-phase commit message delivery and processing also cannot be guaranteed.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">    <span class="nt">&lt;transactionScope</span>
      <span class="na">enabled=</span><span class="s">&quot;true&quot;</span>
      <span class="na">isolationLevel=</span><span class="s">&quot;ReadCommitted&quot;</span>
      <span class="na">timeoutSeconds=</span><span class="s">&quot;30&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<table><thead>
<tr>
<th>Attribute</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>enabled</code></td>
<td>true</td>
<td>If <code>true</code> the message handling code in the receiving pipeline is wrapped in a <code>TransactionScope</code>.</td>
</tr>
<tr>
<td><code>isolationLevel</code></td>
<td>ReadCommitted</td>
<td>The transaction scope isolation level to use.</td>
</tr>
<tr>
<td><code>timeoutSeconds</code></td>
<td>30</td>
<td>The number of seconds before a transaction scope times out.</td>
</tr>
</tbody></table>

<p>When the endpoint is not a physical endpoint but rather a worker use the <code>worker</code> tag to specify the relevant configuration.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">    <span class="nt">&lt;worker</span>
      <span class="na">distributorControlWorkQueueUri=</span><span class="s">&quot;msmq://./control-inbox-work&quot;</span>
      <span class="na">threadAvailableNotificationIntervalSeconds=</span><span class="s">&quot;5&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<table><thead>
<tr>
<th>Attribute</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>distributorControlWorkQueueUri</code></td>
<td>n/a</td>
<td>The control work queue uri of the distributor endpoint that this endpoint can handle messages for.</td>
</tr>
<tr>
<td><code>threadAvailableNotificationIntervalSeconds</code></td>
<td>15</td>
<td>The number of seconds to wait on an idle thread before notifying the distributor of availability <em>again</em></td>
</tr>
</tbody></table>

<p>Since a worker sends thread availability to the physical distribution master the distributor needs to have a special inbox called the control inbox that is used for these notifications.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">    <span class="nt">&lt;control</span>
      <span class="na">workQueueUri=</span><span class="s">&quot;control-inbox-work&quot;</span>
      <span class="na">errorQueueUri=</span><span class="s">&quot;msmq://./shuttle-error&quot;</span>
      <span class="na">threadCount=</span><span class="s">&quot;25&quot;</span>
      <span class="na">durationToSleepWhenIdle=</span><span class="s">&quot;250ms,10s,30s&quot;</span>
      <span class="na">durationToIgnoreOnFailure=</span><span class="s">&quot;30m,1h&quot;</span>
      <span class="na">maximumFailureCount=</span><span class="s">&quot;25&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<table><thead>
<tr>
<th>Attribute</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>threadCount</code></td>
<td>1</td>
<td>The number of worker thread that will service the control work queue.</td>
</tr>
<tr>
<td><code>durationToSleepWhenIdle</code></td>
<td>250ms*4,500ms*2,1s</td>
<td></td>
</tr>
<tr>
<td><code>durationToIgnoreOnFailure</code></td>
<td>5m,10m,15m,30m,60m</td>
<td></td>
</tr>
<tr>
<td><code>maximumFailureCount</code></td>
<td>5</td>
<td>The maximum number of failures that are retried before the message is moved to the error queue.</td>
</tr>
</tbody></table>

<p>Finally just close the relevant tags.</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml">  <span class="nt">&lt;/serviceBus&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
	</div>
</div>


      </div>

    </div>

    <div id="footer">
        <p>&copy; 2014 Eben Roux
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a> / <a href="http://github.com/dhulihan/hooligan" target="_blank">The Hooligan Theme</a>
        </p>
    </div id="footer">

    

    <script src="/assets/themes/shuttle/js/jquery.min.js"></script>
	<script src="/assets/themes/shuttle/js/jquery-ui.js"></script>
	<script src="/assets/themes/shuttle/bootstrap/js/bootstrap.min.js"></script>
	<script src="/assets/themes/shuttle/js/jquery.tocify.js"></script>
	<script src="/assets/themes/shuttle/js/site.js"></script>
  </body>
</html>
